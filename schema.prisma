// This file is automatically generated by Keystone, do not modify it manually.
// Modify your Keystone config when you want to change this.

datasource mysql {
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
  provider          = "mysql"
  relationMode      = "prisma"
}

generator client {
  provider = "prisma-client-js"
  output   = "node_modules/.prisma/client"
}

model User {
  id                           String    @id @default(cuid())
  email                        String    @default("")
  emailVerified                Boolean   @default(false)
  emailVerificationToken       String    @default("")
  emailVerificationTokenExpiry DateTime?
  provider                     String
  password                     String?
  subjectId                    String    @unique @default("")
  createdAt                    DateTime? @default(now())
  account                      Account?  @relation("Account_user")
  role                         String    @default("ACCOUNT")
}

model Account {
  id                 String    @id @default(cuid())
  user               User?     @relation("Account_user", fields: [userId], references: [id])
  userId             String?   @unique @map("user")
  firstName          String    @default("PLEASE_UPDATE")
  surname            String    @default("PLEASE_UPDATE")
  phone              String    @default("PLEASE_UPDATE")
  secondContactName  String    @default("PLEASE_UPDATE")
  secondContactPhone String    @default("PLEASE_UPDATE")
  students           Student[] @relation("Student_account")
  bills              Bill[]    @relation("Bill_account")
  streetAddress      String    @default("PLEASE_UPDATE")
  suburb             String    @default("PLEASE_UPDATE")
  postcode           Int       @default(3550)
  qboSyncToken       Int?
  qboId              Int?
  createdAt          DateTime? @default(now())
}

model Student {
  id          String      @id @default(cuid())
  firstName   String      @default("")
  surname     String      @default("")
  dateOfBirth DateTime    @mysql.Date
  school      String
  yearLevel   Int
  medical     String?     @mysql.Text
  account     Account?    @relation("Student_account", fields: [accountId], references: [id])
  accountId   String?     @map("account")
  enrolments  Enrolment[] @relation("Enrolment_student")
  createdAt   DateTime?   @default(now())

  @@index([accountId])
}

model LessonCategory {
  id          String   @id @default(cuid())
  name        String   @default("")
  slug        String   @unique @default("")
  cost        String   @default("")
  type        String
  length      String   @default("")
  description String?  @mysql.Text
  qboItemId   Int?
  lessons     Lesson[] @relation("Lesson_lessonCategory")
}

model ImportantDate {
  id          String   @id @default(cuid())
  name        String   @default("")
  date        DateTime @mysql.Date
  brief       String   @default("")
  description String?  @mysql.Text
}

model Term {
  id             String       @id @default(cuid())
  name           String       @default("")
  quantity       Int
  year           Int
  startDate      DateTime     @mysql.Date
  endDate        DateTime     @mysql.Date
  lessonTerms    LessonTerm[] @relation("LessonTerm_term")
  from_Bill_term Bill[]       @relation("Bill_term")
}

model LessonTerm {
  id              String      @id @default(cuid())
  status          String
  term            Term?       @relation("LessonTerm_term", fields: [termId], references: [id])
  termId          String?     @map("term")
  lesson          Lesson?     @relation("LessonTerm_lesson", fields: [lessonId], references: [id])
  lessonId        String?     @map("lesson")
  enrolments      Enrolment[] @relation("Enrolment_lessonTerm")
  messages        Message[]   @relation("LessonTerm_messages")
  numberOfLessons Int         @default(0)
  createdAt       DateTime?   @default(now())

  @@index([termId])
  @@index([lessonId])
}

model Lesson {
  id               String          @id @default(cuid())
  name             String          @default("")
  lessonCategory   LessonCategory? @relation("Lesson_lessonCategory", fields: [lessonCategoryId], references: [id])
  lessonCategoryId String?         @map("lessonCategory")
  description      String?         @mysql.Text
  cost             Int
  time             String          @default("")
  lengthMin        Int
  day              String
  minYear          Int
  maxYear          Int
  location         String          @default("")
  createdAt        DateTime?       @default(now())
  lessonTerms      LessonTerm[]    @relation("LessonTerm_lesson")

  @@index([lessonCategoryId])
}

model EmailSettings {
  id                            Int    @id
  fromEmail                     String @default("")
  enrolmentConfirmationTemplate String @default("")
  lessonTermMessageTemplate     String @default("")
}

model QuickBooksSettings {
  id           Int     @id
  realmId      String  @default("")
  accessToken  String? @mysql.Text
  refreshToken String  @default("")
}

model Enrolment {
  id           String      @id @default(cuid())
  lessonTerm   LessonTerm? @relation("Enrolment_lessonTerm", fields: [lessonTermId], references: [id])
  lessonTermId String?     @map("lessonTerm")
  student      Student?    @relation("Enrolment_student", fields: [studentId], references: [id])
  studentId    String?     @map("student")
  status       String
  billItem     BillItem?   @relation("BillItem_enrolment")
  createdAt    DateTime?   @default(now())

  @@index([lessonTermId])
  @@index([studentId])
}

model Message {
  id          String       @id @default(cuid())
  name        String       @default("")
  status      String       @default("DRAFT")
  content     String?      @mysql.Text
  lessonTerms LessonTerm[] @relation("LessonTerm_messages")
  sentAt      DateTime?
  createdAt   DateTime?    @default(now())
}

model Bill {
  id           String     @id @default(cuid())
  name         String     @default("")
  account      Account?   @relation("Bill_account", fields: [accountId], references: [id])
  accountId    String?    @map("account")
  date         DateTime?  @mysql.Date
  dueDate      DateTime?  @mysql.Date
  status       String
  term         Term?      @relation("Bill_term", fields: [termId], references: [id])
  termId       String?    @map("term")
  items        BillItem[] @relation("BillItem_bill")
  qboSyncToken Int?
  qboId        Int?
  createdAt    DateTime?  @default(now())

  @@index([accountId])
  @@index([termId])
}

model BillItem {
  id           String     @id @default(cuid())
  name         String     @default("")
  bill         Bill?      @relation("BillItem_bill", fields: [billId], references: [id])
  billId       String?    @map("bill")
  quantity     Int        @default(1)
  amount       Int
  enrolment    Enrolment? @relation("BillItem_enrolment", fields: [enrolmentId], references: [id])
  enrolmentId  String?    @unique @map("enrolment")
  qboSyncToken Int?
  qboId        Int?
  createdAt    DateTime?  @default(now())

  @@index([billId])
}
